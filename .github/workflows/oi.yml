name: Windows RDP + RustDesk (sem ngrok)

on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 9999

    steps:
      - name: Ativar RDP e definir senha
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 1
          Set-LocalUser -Name "runneradmin" -Password (ConvertTo-SecureString -AsPlainText "@cyb3rking" -Force)

      - name: Baixar RustDesk
        run: |
          certutil -urlcache -split -f "https://github.com/rustdesk/rustdesk/releases/download/1.2.1/rustdesk-1.2.1-x86_64.exe" rustdesk.exe

      - name: Iniciar RustDesk
        run: start "" "rustdesk.exe"

      - name: Aguardar e mostrar ID/senha do RustDesk
        shell: powershell
        run: |
          Start-Sleep -Seconds 15  # tempo para o RustDesk iniciar
          $configDir = "$env:APPDATA\RustDesk\config\RustDesk"
          $idPath = Join-Path $configDir "id"
          $passwordPath = Join-Path $configDir "password"

          if (Test-Path $idPath) {
              Write-Output "`nüìå RustDesk ID:"
              Get-Content $idPath
          } else {
              Write-Output "‚ùå ID do RustDesk n√£o encontrado ainda."
          }

          if (Test-Path $passwordPath) {
              Write-Output "`nüîë Senha do RustDesk:"
              Get-Content $passwordPath
          } else {
              Write-Output "‚ùå Senha do RustDesk n√£o encontrada ainda."
          }
